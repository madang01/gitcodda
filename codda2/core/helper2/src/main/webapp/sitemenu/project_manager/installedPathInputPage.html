<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Codda Helper Web Service</title>
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="/bootstrap/3.3.7/css/bootstrap.css">
<!-- jQuery library -->
<script src="/jquery/3.3.1/jquery.min.js"></script>
<!-- Latest compiled JavaScript -->
<script src="/bootstrap/3.3.7/js/bootstrap.min.js"></script>

<style>
.btn-space {
    margin-right: 5px;
}
</style>

<script type="text/javascript">
<!--
	var isFirst = true;

	function goHome() {
		document.location.href = "/index.html";
	}
	
	function changeInstalledPath() {
		var f = document.installedPathFrm;
		
		if (f.installedPath.value == '') {
			alert("설치 경로를 넣어 주세요");
			f.installedPath.focus();
			return;
		}
		
		var xhttp = new XMLHttpRequest();
		var params = "installedPath="+encodeURI(f.installedPath.value);
		
		xhttp.onreadystatechange = function() {
			if (this.readyState != 4 || this.status != 200) {
				if (this.status != 0 && this.status != 200) {
					callbackForErrorMessageGetter("에러코드="+this.status+", 에러 내용="+this.responseText);
				}
				return;
			}
			
			
			callbackForInstalledPathSetter(this.responseText);
		};
		xhttp.open("GET", "/servlet/InstalledPathSetter?"+params, true);
		xhttp.send();
	}
	
	function callbackForInstalledPathSetter(installedPath) {
		alert("설치 경로["+installedPath+"] 를 변경 완료하였습니다, 프로젝트 주 화면으로 이동합니다.");
		// console.log("설치 경로["+installedPath+"] 를 변경 완료하였습니다, 프로젝트 주 화면으로 이동합니다.");
		document.location.href = "/sitemenu/project_manager/projectMainPage.html";
	}
	
	function getCurrentWorkingPath() {
		// document.hiddenFrame.location.href = "/servlet/CurrentWokingPathInformationGetter";
		
		var xhttp = new XMLHttpRequest();
		
		xhttp.onreadystatechange = function() {
			if (this.readyState != 4 || this.status != 200) {
				if (this.status != 0 && this.status != 200) {
					callbackForErrorMessageGetter("에러코드="+this.status+", 에러 내용="+this.responseText);
				}
				
				return;
			}
			
			callbackForCurrentWokingPathInformationGetter(JSON.parse(this.responseText));
		};
		xhttp.open("GET", "/servlet/CurrentWokingPathInformationGetter", true);
		xhttp.send();
	}

	function callbackForCurrentWokingPathInformationGetter(currentWorkPathInformationJson) {		
		var currentWorkingPathObj = document.getElementById("currentWorkingPath");
		currentWorkingPathObj.innerText = currentWorkPathInformationJson.currentWorkingPathString;
		
		
		var directoryListPartObj = document.getElementById("directoryListPart");
		while (directoryListPartObj.hasChildNodes()) {
			directoryListPartObj.removeChild(directoryListPartObj.firstChild);
		}
			
		
		var i=0;
		
		while (true) {
			if (i >= currentWorkPathInformationJson.chiledPathStringList.length) {
				break;
			}
			
			var rowDiv = document.createElement("div");
			rowDiv.setAttribute("class", "row");
			
			
			for (var j=0; j < 4; j++) {		
				var chiledPathString = currentWorkPathInformationJson.chiledPathStringList[i];
				
				console.log("chiledPathString="+chiledPathString);
				
				
				
				var aTagOfCol = document.createElement("a");
				aTagOfCol.setAttribute("href", "javascript:moveChildDirectory(\"" + chiledPathString + "\");");				
				
				var imgTagOfATag = document.createElement("img");
				imgTagOfATag.setAttribute("src", "/image/iconmonstr-folder-open-thin.svg");
				imgTagOfATag.setAttribute("width", "80px");
				imgTagOfATag.setAttribute("height", "80px");
				
				aTagOfCol.appendChild(imgTagOfATag);
				
				var brTagOfCol = document.createElement("br");
				var textTagOfCol = document.createTextNode(chiledPathString);
				
				
				var colDiv = document.createElement("div");
				colDiv.setAttribute("class", "col-sm-3");
				// colDiv.innerHTML = "<a href='javascript:moveChildDirectory(\"" + chiledPathString + "\");' onclick='return false;'><img src=\"/image/iconmonstr-folder-open-thin.svg\" width=\"80px\" height=\"80px\"></a><br>" + chiledPathString;
				colDiv.appendChild(aTagOfCol);
				colDiv.appendChild(brTagOfCol);
				colDiv.appendChild(textTagOfCol);				
				
				rowDiv.appendChild(colDiv);
				
				i++;
				
				if (i >= currentWorkPathInformationJson.chiledPathStringList.length) {
					break;
				}
			}
			
			directoryListPartObj.appendChild(rowDiv);			
		}
		
		if (isFirst) {
			copyCurrentWorkingDirectoryToInstalledPath();
			isFirst = false;
		}
	}
	
	function copyCurrentWorkingDirectoryToInstalledPath() {
		var currentWorkingPathObj = document.getElementById("currentWorkingPath");
		var f = document.installedPathFrm;
		f.installedPath.value = currentWorkingPathObj.innerText;
	}
	
	
	function moveChildDirectory(childShortDirectoryName) {
		var xhttp = new XMLHttpRequest();
		var params = "shortPathNameToMove="+encodeURI(childShortDirectoryName);
		
		xhttp.onreadystatechange = function() {
			if (this.readyState != 4 || this.status != 200) {
				if (this.status != 0 && this.status != 200) {
					callbackForErrorMessageGetter("에러코드="+this.status+", 에러 내용="+this.responseText);
				}
				return;
			}
			
			
			callbackForCurrentWokingPathInformationGetter(JSON.parse(this.responseText));
		};
		xhttp.open("GET", "/servlet/CurrentWokingPathSetter?"+params, true);
		xhttp.send();
	}
	
	function moveParentDirectory() {
		// document.hiddenFrame.location.href = "/servlet/CurrentWokingPathSetter?shortPathNameToMove=..";
		
		var xhttp = new XMLHttpRequest();
		var params = "shortPathNameToMove=..";
		
		xhttp.onreadystatechange = function() {
			if (this.readyState != 4 || this.status != 200) {
				if (this.status != 0 && this.status != 200) {
					callbackForErrorMessageGetter("에러코드="+this.status+", 에러 내용="+this.responseText);
				}
				return;
			}
			
			
			callbackForCurrentWokingPathInformationGetter(JSON.parse(this.responseText));
		};
		xhttp.open("GET", "/servlet/CurrentWokingPathSetter?" + params, true);
		xhttp.send();
	}
	
	function callbackForErrorMessageGetter(errorMessage) {
		var errorMessageObj = document.getElementById("errorMessage");
		errorMessageObj.setAttribute("class", "alert alert-danger");
		errorMessageObj.innerText = errorMessage;
		
		// alert(errorMessage)
	}
	
	
	function init() {
		if (typeof (sessionStorage) == "undefined") {
			alert("Sorry! No HTML5 sessionStorage support..");
			document.location.href = "/html5_no_support.html";
			return;
		}
		
		getCurrentWorkingPath();
	}

	window.onload = init;
//-->
</script>
</head>
<body>
	<div class="content">
		<div class="container">
			<div class="panel panel-default">
				<div class="panel-heading">프로젝트 관리자::코다 설치 경로 지정 화면</div>
				<div class="panel-body">
					<div class="row">
						<div class="col-sm-12">
							<div class="btn-group">
								<button type="button" class="btn btn-primary btn-sm btn-space" onClick="goHome();">HOME</button>
							</div>
						</div>
					</div>
					<div class="row"><div class="col-sm-12">&nbsp;</div></div>					
					<div class="row">
						<div class="col-sm-12">
							<div id="errorMessage"></div>
						</div>
					</div>						
					<div class="row">
						<div class="form-group">
							<form name="installedPathFrm" method="post">
								<div class="col-sm-2"><label for="installedPath">코다 설치 경로</label></div>
								<div class="col-sm-8"><input type="text" class="form-control" name="installedPath" id="installedPath"></div>
								<div class="col-sm-2"><button type="button" class="btn btn-default" onClick="changeInstalledPath();">확인</button></div>
							</form>
						</div>
					</div>				
					<div class="row"><div class="col-sm-12">&nbsp;</div></div>
					<div class="row">
						<div class="col-sm-12"><label>현재 작업 경로</label></div>
					</div>
					<div class="row">
						<div class="col-sm-12">
							<label id="currentWorkingPath">D:&#92;gitcodda</label><label style="width: 30px;">&nbsp;</label>
							<div class="btn-group">
								<button type="button" class="btn btn-primary btn-sm btn-space" onClick="copyCurrentWorkingDirectoryToInstalledPath();">선택</button>
								<button type="button" class="btn btn-primary btn-sm btn-space" onClick="getCurrentWorkingPath();">새로고침</button>
								<button type="button" class="btn btn-primary btn-sm btn-space" onClick="moveParentDirectory();">이전경로</button>
							</div>
						</div>
					</div>	
					<div class="row"><div class="col-sm-12">&nbsp;</div></div>
					<div id="directoryListPart"><div class="row">
	<div class="col-sm-3"><a href='javascript:moveChildDirectory(\"1번_자식폴더\");'><img src="/image/iconmonstr-folder-open-thin.svg" width="80px" height="80px"></a><br>1번_자식폴더</div>
	<div class="col-sm-3"><a href='javascript:moveChildDirectory(\"2번_자식폴더\");'><img src="/image/iconmonstr-folder-open-thin.svg" width="80px" height="80px"></a><br>2번_자식폴더</div>
	<div class="col-sm-3"><a href='javascript:moveChildDirectory(\"3번_자식폴더\");'><img src="/image/iconmonstr-folder-open-thin.svg" width="80px" height="80px"></a><br>3번_자식폴더</div>
	<div class="col-sm-3"><a href='javascript:moveChildDirectory(\"4번_자식폴더\");'><img src="/image/iconmonstr-folder-open-thin.svg" width="80px" height="80px"></a><br>4번_자식폴더22222434343434343434343</div>
</div><div class="row">
	<div class="col-sm-3"><a href='javascript:moveChildDirectory(\"5번_자식폴더\");'><img src="/image/iconmonstr-folder-open-thin.svg" width="80px" height="80px"></a><br>5번_자식폴더</div>
	<div class="col-sm-3"><a href='javascript:moveChildDirectory(\"6번_자식폴더\");'><img src="/image/iconmonstr-folder-open-thin.svg" width="80px" height="80px"></a><br>6번_자식폴더</div>
</div></div>
				</div>
			</div>
		</div>
	</div>
</body>
</html>